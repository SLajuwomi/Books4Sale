# nixpacks.toml

[phases.install]
cmds = [
    "mkdir -p /app/public_html/storage/framework/views /app/public_html/storage/framework/cache /app/public_html/storage/framework/sessions",
    "chmod -R 775 /app/public_html/storage"
]

[phases.build]
cmds = [
    "composer install --no-dev --optimize-autoloader",
    "npm install",
    "echo '--- DEBUG: Contents of package.json ---'",
    "cat /app/public_html/package.json",
    "echo '--- DEBUG: Contents of postcss.config.js ---'",
    "cat /app/public_html/postcss.config.js",
    "echo '--- END DEBUG ---'",
    "npm run prod"
]

[start]
cmd = "php-fpm -y /assets/php-fpm.conf -F & nginx -c /assets/nginx.conf"